import{t as N,a2 as I,d as T,o as Q,w as J,M as B,F as U,H as k,c as t,l as s,G as l,J as _,ad as j,W as X,E as W,Q as V,T as M,O as Y,N as Z,K as z,a6 as P,a4 as F,a5 as h,R as ee}from"./index-CtZFkp4p.js";import{I as te}from"./index-E3_dwGbR.js";import{_ as ae,B as A,e as ne}from"./TextArea-Cs30zvrZ.js";import{F as R,_ as oe,I as se}from"./index-BOfr_Bk3.js";import{C as le}from"./index-Bov8DSqh.js";import{_ as E}from"./index-v7h9a5p3.js";import{D as re}from"./DeleteOutlined-DpsNfBA6.js";import{S as ie}from"./index-BGqO3MUF.js";import{P as H}from"./index-CTzm4KRz.js";import{a as L,T as ue,P as pe}from"./navs-CfyB2w-a.js";import{a as de}from"./equipment-category-DXswjgf1.js";import{u as me}from"./equipment-supplier-D-xeEh6G.js";import{V as _e}from"./index-IE6I45p-.js";import{_ as ce,a as fe}from"./status-DgKBotGj.js";import{S as ge}from"./index-KCGl6bU8.js";import{S as ve}from"./index-B_brma43.js";function ye(f){const g=I,r=N(!1);return{upload:async(o,{onStart:a,onSuccess:v,onFailed:n})=>{if(!f){g.error("未配置上传地址");return}r.value=!0,a==null||a();try{const q=new FormData;q.append("file",o);const x=await fetch(f,{method:"POST",body:q});if(!x.ok){n==null||n();return}const d=await x.json();if(d.code!==0){g.error(d.message),n==null||n();return}v==null||v(d.data)}catch{n==null||n()}finally{r.value=!1}},loading:r}}const be={class:"flex items-center gap-x-4 overflow-hidden"},qe={class:"block flex-[0_0_30%]"},xe={class:"flex-[0_0_20%] space-y-4"},Ce=T({__name:"ImageViewer",props:{description:{},source:{},asDefault:{type:Boolean}},emits:["input","delete","onSelected"],setup(f){const g=f,r=N(""),c=N(new FileReader);return Q(()=>{c.value.onload=o=>{r.value=o.currentTarget.result}}),J(()=>g.source,o=>{o instanceof File?c.value.readAsDataURL(o):r.value=o},{immediate:!0}),(o,a)=>{const v=te,n=ae,q=le,x=E,d=A;return U(),B("div",be,[k("div",qe,[t(v,{src:s(r),width:"100%",height:"200px",class:"object-cover"},null,8,["src"])]),t(n,{value:o.description,onInput:a[0]||(a[0]=C=>o.$emit("input",C.target.value)),style:{height:"200px"},placeholder:"请输入简介",bordered:!1,class:"!p-0 placeholder:!text-gray-500"},null,8,["value"]),k("div",xe,[t(q,{checked:o.asDefault,onChange:a[1]||(a[1]=C=>o.$emit("onSelected",C.target.checked?1:0))},{default:l(()=>a[3]||(a[3]=[_("设为默认")])),_:1,__:[3]},8,["checked"]),t(x),t(d,{type:"primary",danger:"",onClick:a[2]||(a[2]=C=>o.$emit("delete"))},{icon:l(()=>[t(s(re))]),default:l(()=>[a[4]||(a[4]=_(" 删除 "))]),_:1,__:[4]})])])}}}),we={class:"mb-4 space-y-2"},he={class:"flex items-center gap-x-2 text-lg"},ke=T({__name:"index",props:j({uploadUrl:{},maxCount:{default:20}},{value:{default:[]},valueModifiers:{}}),emits:j(["change","delete","selected"],["update:value"]),setup(f,{emit:g}){const r=f,c=g,o=X(f,"value"),a=R.useInjectFormItemContext(),v=N(null),{upload:n,loading:q}=ye(r.uploadUrl),x=()=>{var e;(e=v.value)==null||e.click()},d=e=>{const u=e.target.files;if(!u||u.length===0){I.warning("请选择文件");return}const p=u[0];if(!p.type.startsWith("image")){I.warning("只能选择图片文件");return}if(o.value.length>=r.maxCount){I.warning(`最多上传 ${r.maxCount} 张图片`);return}if(o.value.some(i=>i.imageUrl.includes(p.name))){I.warning("图片已存在");return}e.target.value="",n(p,{onSuccess:i=>{var D;const b={imageUrl:i,asDefault:0,description:""};o.value.push(b),c("change",b),(D=a.onFieldChange)==null||D.call(a)},onFailed:()=>{I.error("上传失败")}})},C=(e,u)=>{var p;o.value[e].description=u,c("change",o.value[e]),(p=a.onFieldChange)==null||p.call(a)},O=e=>{var i;const u=o.value.findIndex(b=>b.imageUrl===e),p=o.value[u];o.value.splice(u,1),c("delete",p),(i=a.onFieldChange)==null||i.call(a)},y=e=>{var p;const u=P(o.value);u.forEach((i,b)=>{i.asDefault=i.asDefault!==1&&e===b?1:0}),o.value=[...u],c("selected",P(o.value[e])),(p=a.onFieldChange)==null||p.call(a)};return(e,u)=>{const p=E,i=ie,b=L,D=ne;return U(),W(D,null,{default:l(()=>[V(k("div",we,[(U(!0),B(Y,null,Z(o.value,(w,S)=>(U(),B("div",{key:w.imageUrl},[t(Ce,{source:`/minio${w.imageUrl}`,description:w.description,"as-default":w.asDefault===1,onInput:$=>C(S,$),onDelete:()=>O(w.imageUrl),onOnSelected:$=>y(S)},null,8,["source","description","as-default","onInput","onDelete","onOnSelected"]),t(p)]))),128))],512),[[M,o.value.length>0]]),V(k("div",he,[t(i),u[0]||(u[0]=_("上传中,请稍后...... "))],512),[[M,s(q)]]),V(k("div",{class:"group group flex h-28 w-28 cursor-pointer items-center justify-center rounded-md border-2 border-dashed border-gray-200 bg-gray-100 transition-all hover:border-blue-600",onClick:x},[t(s(H),{class:"text-2xl !text-gray-400 group-hover:!text-blue-600"}),k("input",{ref_key:"fileInput",ref:v,type:"file",hidden:"",accept:"image/*",onChange:d},null,544)],512),[[M,!s(q)&&o.value.length<e.maxCount]]),t(b,{type:"secondary",class:"mt-2 inline-block text-xs"},{default:l(()=>[_(" 最多只可以上传 "+z(e.maxCount)+" 个图片。 ",1)]),_:1})]),_:1})}}}),ze=T({__name:"EditForm",props:{disabled:{type:Boolean},initData:{}},emits:["submit"],setup(f,{expose:g,emit:r}){const c=f,o=r,{data:a}=de(),{data:v}=me(),n=F({equipmentCode:"",equipmentName:"",model:"",status:void 0,equipmentCategoryIds:[],equipmentSupplierId:void 0,images:[],removeImages:[]}),{validate:q,resetFields:x,validateInfos:d}=R.useForm(n,F({equipmentCode:[{required:!0,message:"请输入设备编号"}],equipmentName:[{required:!0,message:"请输入设备名称"}],model:[{required:!0,message:"请输入设备型号"}],equipmentCategoryIds:[{required:!0,type:"array",min:1,message:"请选择设备类型"}],equipmentSupplierId:[{required:!0,message:"请选择供应商"}],status:[{required:!0,message:"请选择状态"}],images:[{required:!0,type:"array",min:1,message:"请上传图片"}]}));J(()=>c.initData,y=>{y&&Object.assign(n,c.initData)},{immediate:!0});const C=()=>{q().then(()=>{o("submit",P(n)),n.removeImages=[]}).catch(y=>{})},O=y=>{var e;y.id&&((e=n.removeImages)==null||e.push(y))};return g({resetFields:x}),(y,e)=>{const u=se,p=L,i=oe,b=ce,D=E,w=A,S=ve,$=ge,G=ke,K=R;return U(),W(K,{"label-col":{span:4},disabled:y.disabled,autocomplete:"off",onFinish:C},{default:l(()=>[t(i,h({name:"equipmentCode",label:"设备编号"},s(d).equipmentCode),{default:l(()=>[t(u,{value:s(n).equipmentCode,"onUpdate:value":e[0]||(e[0]=m=>s(n).equipmentCode=m),placeholder:"请输入设备编号"},null,8,["value"]),t(p,{type:"secondary",style:{"font-size":"12px"}},{default:l(()=>e[8]||(e[8]=[_(" 建议格式：类型缩写 + 流水号，如 DJ-001、CSB-20240501，用于系统唯一识别 ")])),_:1,__:[8]})]),_:1},16),t(i,h({name:"equipmentName",label:"设备名称"},s(d).equipmentName),{default:l(()=>[t(u,{value:s(n).equipmentName,"onUpdate:value":e[1]||(e[1]=m=>s(n).equipmentName=m),placeholder:"请输入设备名称"},null,8,["value"])]),_:1},16),t(i,h({name:"model",label:"设备型号"},s(d).model),{default:l(()=>[t(u,{value:s(n).model,"onUpdate:value":e[2]||(e[2]=m=>s(n).model=m),placeholder:"请输入设备型号"},null,8,["value"]),t(p,{type:"secondary",style:{"font-size":"12px"}},{default:l(()=>e[9]||(e[9]=[_(" 建议填写生产厂家提供的型号信息，例如 DJ-800X、USW-300 等 ")])),_:1,__:[9]})]),_:1},16),t(i,h({name:"equipmentCategoryIds",label:"设备类型"},s(d).equipmentCategoryIds),{default:l(()=>[t(b,{value:s(n).equipmentCategoryIds,"onUpdate:value":e[3]||(e[3]=m=>s(n).equipmentCategoryIds=m),"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"请选择设备类型","allow-clear":"",multiple:"","tree-default-expand-all":"","field-names":{label:"categoryName",value:"id"},"tree-data":s(a),"tree-node-filter-prop":"categoryName"},null,8,["value","tree-data"])]),_:1},16),t(i,h({name:"equipmentSupplierId",label:"供应商"},s(d).equipmentSupplierId),{default:l(()=>[t($,{value:s(n).equipmentSupplierId,"onUpdate:value":e[5]||(e[5]=m=>s(n).equipmentSupplierId=m),style:{width:"100%"},placeholder:"请选择供应商",options:s(v),"field-names":{label:"supplierName",value:"id"},"allow-clear":""},{dropdownRender:l(({menuNode:m})=>[t(s(_e),{vnodes:m},null,8,["vnodes"]),t(D),t(S,{class:"px-2"},{default:l(()=>[e[11]||(e[11]=k("div",{class:"text-black/60"},"没有对应的供应商？",-1)),t(w,{block:"",type:"primary",onClick:e[4]||(e[4]=Ie=>y.$router.push("/equipment/supplier"))},{icon:l(()=>[t(s(H))]),default:l(()=>[e[10]||(e[10]=_(" 去新增 "))]),_:1,__:[10]})]),_:1,__:[11]})]),_:1},8,["value","options"])]),_:1},16),t(i,h({name:"status",label:"状态"},s(d).status),{default:l(()=>[t($,{value:s(n).status,"onUpdate:value":e[6]||(e[6]=m=>s(n).status=m),style:{width:"100%"},placeholder:"请选择状态",options:s(fe),"allow-clear":""},null,8,["value","options"])]),_:1},16),t(i,h({name:"images",label:"图片"},s(d).images),{default:l(()=>[t(G,{value:s(n).images,"onUpdate:value":e[7]||(e[7]=m=>s(n).images=m),"upload-url":"/api/equipment-images/upload",onDelete:O},null,8,["value"])]),_:1},16),t(i,{"wrapper-col":{offset:4}},{default:l(()=>[t(S,null,{default:l(()=>[t(w,{type:"primary",onClick:ee(C,["prevent"])},{default:l(()=>e[12]||(e[12]=[_("提交")])),_:1,__:[12]}),t(w,{"html-type":"reset",onClick:s(x)},{default:l(()=>e[13]||(e[13]=[_("重置")])),_:1,__:[13]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["disabled"])}}}),De={class:"px-8"},Ae=T({__name:"EditFormDescription",props:{title:{}},setup(f){return(g,r)=>{const c=E,o=ue,a=pe;return U(),B("div",De,[t(c),t(o,{level:5,class:"!text-black/60"},{default:l(()=>[_(z(g.title),1)]),_:1}),t(a,{class:"!text-black/60"},{default:l(()=>r[0]||(r[0]=[_(" 1. 设备名称、型号等基本信息为必填项，请确保信息的准确性和完整性。 ")])),_:1,__:[0]}),t(a,{class:"!text-black/60"},{default:l(()=>r[1]||(r[1]=[_(" 2. 设备图片建议上传清晰的实物照片，便于识别和管理。 ")])),_:1,__:[1]}),t(a,{class:"!text-black/60"},{default:l(()=>r[2]||(r[2]=[_(" 3. 设备参数请按照实际情况填写，如有特殊说明请在备注中注明。 ")])),_:1,__:[2]}),t(a,{class:"!text-black/60"},{default:l(()=>r[3]||(r[3]=[_(" 4. 编辑完成后请确认信息无误后提交。 ")])),_:1,__:[3]})])}}});export{ze as _,Ae as a};
